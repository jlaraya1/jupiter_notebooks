



---
title: "Ejemplo de relleno usando ePCA"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
##output: html_document
---




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Departamento de Redes y Procesamiento de Datos 
##Instituto Meteorológico Nacional 
##Dr. José Luis Araya López

Este tutorial es una descripción de cómo debe de usarse el código para procesar los datos en su totalidad y obtener productos
de datos rellenados usando el algoritmo ePCA
 

```

rm(list = ls())

#################
#import Libraries
library("plyr")
################

source("/home/jlaraya/Documents/BaseEspejo/codigo/funciones.R")
ruta<-"/home/jlaraya/Documents/BaseEspejo/reportesDiariosYMensuales/datos"
setwd(ruta)
print(dir())
files=dir()
opcion<-menu(0)
if(opcion==1|4 ){encab=c("CUENCA","ESTACION","FECHA","HORA","DATOS")}
#if(opcion==4){encab=c("CUENCA","ESTACION","FECHA","HORA","DATOS")}
caracter_separador=","
guardeEn="../datos2/mod_"

```

1) se cargan los datos bajados de la base de datos y se reemplaza
el caracter de separacion a forma columnar:

```
cambiando_separadores(files,caracter_separador,guardeEn)
```

2) Se separa todo el archivo con las series juntas en archivos
de datos individuales por numero de estación y cuenca:

```
setwd("../datos2")
print(dir())
files=dir()
require(readr)
library(lubridate)
#temperatura:
separe_series(files[1])

```


3) Se completa el eje de tiempo:

```
files=dir()
files=selectSomeFiles(files,1,9,"separados",".txt")
timeSpan_hours=55000
starting_date="2013-01-01 UTC"
saveHere="../datos3/ejeCompleto"
estadisticas_ejeCompleto=completar_ejeTemporal(files,timeSpan_hours,starting_date,saveHere) 
write.table(as.data.frame(estadisticas_ejeCompleto), file="../datos3/estadAll.txt",row.names = F,col.names=TRUE)

```




Ahora vamos con los cálculos de los reportes:


```
print("se cargan los datos en carpeta --datos3-- ")
ruta<-"/home/jlaraya/Documents/BaseEspejo/reportesDiariosYMensuales/datos3/"
setwd(ruta)
opcion<-menu(0)
print(dir())
lista<-dir()
lista=selectSomeFiles(lista,1,11,"ejeCompleto",".txt")
resol<-"day"
rutaFinal <-"../resultados/"
```


Cálculo de Promedios diarios de temperatura
Cálculo de Totales diarios de lluvia horaria

```
reso<-"hour"  #resolución de los datos originales
guardeEn <-"../resultadosDay/"
prefijo="Auto_Dia-"
resol<-"day"
diviHora<-1
if(opcion==1){Calculo= "promedio"}
if(opcion==4){Calculo= "total"}
tipoRep<-"todo"
reportesD_Q_M_Y(lista,opcion,reso,resol,guardeEn,Calculo,prefijo,tipoRep)
```

